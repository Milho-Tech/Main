<!doctype html>
<html>

<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script> -->
    <link rel="stylesheet" href="css/styledashboard.css">
    <script src="js/sessao.js"></script>
   
</head>

<body onload='geral(), ultimaMedicaoUmid1(), ultimaMedicaoTemp1(), ultimaMedicaoUmid2(), ultimaMedicaoTemp2(), ultimaMedicaoTemp3(), ultimaMedicaoUmid3(), ultimaMedicaoUmid4(), ultimaMedicaoTemp4(), maiorTemp(), menorTemp(), menorUmid(), maiorUmid(), obterUltimaMedicao()'>


    <div class="div_conteudo" id="div_conteudo">

        <div class="div_lateral" id="div_lateral">

            <img src="assets/imgs/user.png" alt="Foto indisponivel">
            <br>
            <br>
            <ul class="navbar">
                <li>Empresa: <span>MilhoFarm</span></li>
                <li>Usuário: <span id="nome_user">Fernando Brandão</span></li>
                <li><a href="#" onclick="geral()" id="botaogeral">Visão Geral</a></li>
                <li><a href="#" onclick="silo1()" id="botaosilo1">Silo 1</a></li>
                <li><a href="#" onclick="silo2()" id="botaosilo2">Silo 2</a></li>
                <li><a href="#" onclick="silo3()" id="botaosilo3">Silo 3</a></li>
                <li><a href="#" onclick="silo4()" id="botaosilo4">Silo 4</a></li>

                <li><a href="#">Contato</a></li>
            </ul>
            <br>
            <br>

            <a href="index.html"><img src="assets/imgs/sair.png" class="img_sair" style="filter: invert(100%);"></a>


        </div>

        <div id="btn_mostra" class="botao_mostra">
            <button id="btn_mostrar" class="botao_mostrar" onclick="mostrar()"></button>
        </div>
        <div id="btn_tira" class="botao_tira">
            <button id="btn_tirar" class="botao_tirar" onclick="apagar()"></button>
        </div>


        <div class="geral" id="div_geral">
            <div class="caixa-info">
                <div class="informacoes" id="div_informacoes">
                    <div class="infos" id="div_todos numeros">
                        <div onclick="silo1()" class="numeros" id="div_numeros" style="background-color: rgb(255, 187, 187);">
                            <a>
                                <h3>Silo 1:</h3>
                                <img src="img/temp.png" alt="">
                                <span style="color: #000000;" id="temperatura_silo1">Sem medição</span>
                                <img src="img/umid.png" alt="">
                                <span style="color: #000000;" id="umidade_silo1">Sem medição</span>
                            </a>
                        </div>

                        <div onclick="silo2()" class="numeros" id="div_numeros" style="background-color: rgb(255, 187, 187);">
                            <a>
                                <h3>Silo 2:</h3>
                                <img src="img/temp.png" alt="">
                                <span style="color: #000000;" id="temperatura_silo2">30,4</span>
                                <img src="img/umid.png" alt="">
                                <span style="color: #000000;" id="umidade_silo2">80</span>
                            </a>

                        </div>

                        <div onclick="silo3()" class="numeros" id="div_numeros" style="background-color: rgb(255, 187, 187);
                    color: #cb0000;">
                            <a>
                                <h3>Silo 3:</h3>
                                <img src="img/temp.png" alt="">
                                <span style="color: #000000;" id="temperatura_silo3">20</span>
                                <img src="img/umid.png" alt="">
                                <span style="color: #000000;" id="umidade_silo3">58</span>
                            </a>
                        </div>
                        <div onclick="silo4()" class="numeros" id="div_numeros" style="background-color: rgb(169, 243, 167);">
                            <a>
                                <h3>Silo 4:</h3>
                                <img src="img/temp.png" alt="">
                                <span style="color: #000000;" id="temperatura_silo4">17.4</span>
                                <img src="img/umid.png" alt="">
                                <span style="color: #000000;" id="umidade_silo4">13</span>
                            </a>

                            </a>
                        </div>
                    </div>

                </div>

            </div>


            <div class="pai_titulo" id="div_silo">
            </div>

            <div class="box_inicio" id="box_inicio">

                <div id="dashintrod" class="introducaodash"><br>
                    <h3>Olá,<span id="b_usuario2">usuário</span>!</h3><br>
                    <h3>Ultima medição: <span style="color: #2C3E50;" id="data_medicao">Sem medição</span></h3>
                    <h3>Silo com maior temperatura:<span style="color: #2C3E50;" id="maiortemp_milho">Silo 2</span> </h3>
                    <h3>Silo com menor temperatura:<span style="color: #2C3E50;" id="menortemp_milho">Silo 4</span> </h3>
                    <h3>Silo com menor umidade:<span style="color: #2C3E50;" id="maiorumi_milho"> </span>
                    </h3>
                    <h3>Silo com maior umidade: <span style="color: #2C3E50;" id="menorumi_milho"> </span>
                    </h3><br>
                </div>

            </div>

            <div class="box_silo1" id="box_silo1">
                <section id="sessao_tempsilo1" class="graph">
                    <h1 class="text">Temperatura</h1>
                    <canvas id="myCharttemp1"></canvas>
                </section>
                <section id="sessao_umisilo1" class="graph2">
                    <h1 class="text">Umidade</h1>
                    <canvas id="myCharthumi1"></canvas>
                </section>
            </div>

            <div class="box_silo2" id="box_silo2">
                <section id="sessao_tempsilo2" class="graph">
                    <h1 class="text">Temperatura</h1>
                    <canvas id="myChart3"></canvas>
                </section>
                <section id="sessao_umisilo2" class="graph2">
                    <h1 class="text">Umidade</h1>
                    <canvas id="myChart4"></canvas>
                </section>
            </div>

            <div class="box_silo3" id="box_silo3">
                <section id="sessao_tempsilo3" class="graph">
                    <h1 class="text">Temperatura</h1>
                    <canvas id="myChart7"></canvas>
                </section>
                <section id="sessao_umisilo3" class="graph2">
                    <h1 class="text">Umidade</h1>
                    <canvas id="myChart8"></canvas>
                </section>
            </div>

            <div class="box_silo4" id="box_silo4">
                <section id="sessao_tempsilo4" class="graph">
                    <h1 class="text">Temperatura</h1>
                    <canvas id="myChart9"></canvas>
                </section>
                <section id="sessao_umisilo4" class="graph2">
                    <h1 class="text">Umidade</h1>
                    <canvas id="myChart10"></canvas>
                </section>
            </div>


            <div class="caixa-info">
                <div class="infos" id="div_informacoes">
                    <div class="numeros" id="div_numeros">
                        <div class="numeros perigo_frio" id="div_numeros">
                            <span>Perigo</span>
                            <span>
                                <= 10%</span>
                        </div>

                        <div class="numeros alerta" id="div_numeros">
                            <span>Alerta</span>
                            <span>
                                = 12%</span>

                        </div>
                        <div class="numeros ideal" id="div_numeros">
                            <span>Ideal</span>
                            <span> 13% ~ 15%</span>

                        </div>

                        <div class="numeros alerta" id="div_numeros">
                            <span>Alerta</span>
                            <span> = 16%</span>

                        </div>
                        <div class="numeros perigo_quente" id="div_numeros">
                            <span>Perigo</span>
                            <span> >= 17%</span>

                            </a>
                        </div>

                    </div>

                </div>
            <div class="caixa-info">
                <div class="infos" id="div_informacoes">
                    <div class="numeros" id="div_numeros">
                        <div class="numeros perigo_frio" id="div_numeros">
                            <span>Perigo</span>
                            <span>
                                <= 13°C</span>
                        </div>

                        <div class="numeros alerta" id="div_numeros">
                            <span>Alerta</span>
                            <span>
                                <= 14°C</span>

                        </div>
                        <div class="numeros ideal" id="div_numeros">
                            <span>Ideal</span>
                            <span> 15° ~ 18°C</span>

                        </div>

                        <div class="numeros alerta" id="div_numeros">
                            <span>Alerta</span>
                            <span> >= 18°C</span>

                        </div>
                        <div class="numeros perigo_quente" id="div_numeros">
                            <span>Perigo</span>
                            <span> >= 21°C</span>

                            </a>
                        </div>

                    </div>

                </div>
                <div class="geral" id="div_geral">

                </div>

            </div>

            <!-- <img class="logo" src="img/logo.png" alt=""> -->
</body>

</html>

<script>
    nome_user.innerHTML = sessionStorage.NOME_USUARIO;
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    var idUsuario = sessionStorage.ID_USUARIO;
    var idSilo = 1;
    var idEmpresa = sessionStorage.ID_EMPRESA;

    function ultimaMedicaoTemp1(idSilo) {
    fetch(`/medidas/ultimaMedicaoTemp1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var temperaturaAtual = data.temperatura_atual;
            document.getElementById('temperatura_silo1').innerHTML = temperaturaAtual;
            setTimeout(() => ultimaMedicaoTemp1(idSilo), 2000);
        })
        .catch(error => console.error('Falha na captura de rodada', error));


}

function ultimaMedicaoUmid1(idSilo) {
    fetch(`/medidas/ultimaMedicaoUmid1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var umidadeAtual = data.umidade_atual;
            document.getElementById('umidade_silo1').innerHTML = umidadeAtual;
            setTimeout(() => ultimaMedicaoUmid1(idSilo), 2000);

        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoTemp2(idSilo) {
    fetch(`/medidas/ultimaMedicaoTemp1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var temperaturaAtual = data.temperatura_atual;
            document.getElementById('temperatura_silo2').innerHTML = (temperaturaAtual * 1.25).toFixed(2);
            setTimeout(() => ultimaMedicaoTemp2(idSilo), 2000);
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoUmid2(idSilo) {
    fetch(`/medidas/ultimaMedicaoUmid1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var umidadeAtual = data.umidade_atual;
            document.getElementById('umidade_silo2').innerHTML = (umidadeAtual * 1.25).toFixed(2);
            setTimeout(() => ultimaMedicaoUmid2(idSilo), 2000);
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoTemp3(idSilo) {
    fetch(`/medidas/ultimaMedicaoTemp1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var temperaturaAtual = data.temperatura_atual;
            document.getElementById('temperatura_silo3').innerHTML = (temperaturaAtual * 0.75).toFixed(2);
            setTimeout(() => ultimaMedicaoTemp3(idSilo), 2000);

        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoUmid3(idSilo) {
    fetch(`/medidas/ultimaMedicaoUmid1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var umidadeAtual = data.umidade_atual;
            document.getElementById('umidade_silo3').innerHTML = (umidadeAtual * 0.75).toFixed(2);

            setTimeout(() => ultimaMedicaoUmid3(idSilo), 2000);

        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoTemp4(idSilo) {
    fetch(`/medidas/ultimaMedicaoTemp1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var temperaturaAtual = data.temperatura_atual;
            document.getElementById('temperatura_silo4').innerHTML = (temperaturaAtual * 2).toFixed(2);
            setTimeout(() => ultimaMedicaoTemp4(idSilo), 2000);

        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function ultimaMedicaoUmid4(idSilo) {
    fetch(`/medidas/ultimaMedicaoUmid1/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var umidadeAtual = data.umidade_atual;
            document.getElementById('umidade_silo4').innerHTML = (umidadeAtual * 2).toFixed(2);
            setTimeout(() => ultimaMedicaoUmid4(idSilo), 2000);

        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function maiorTemp(idSilo) {
    fetch(`/medidas/maiorTemp/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var maiorTemperatura = data.silo_maiortemp;
            document.getElementById('maiortemp_milho').innerHTML += maiorTemperatura;
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function menorTemp(idSilo) {
    fetch(`/medidas/menorTemp/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var menorTemperatura = data.silo_menortemp;
            document.getElementById('menortemp_milho').innerHTML += menorTemperatura;
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function menorUmid(idSilo) {
    fetch(`/medidas/menorUmid/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var menorUmidade = data.silo_menorumid;
            document.getElementById('menorumi_milho').innerHTML += 'Silo 4';
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function maiorUmid(idSilo) {
    fetch(`/medidas/maiorUmid/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var maiorUmidade = data.silo_maiorumid;
            document.getElementById('maiorumi_milho').innerHTML += 'Silo 1';
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}

function obterUltimaMedicao(idSilo) {
    fetch(`/medidas/ultimaMedicao/${idSilo}`, { cache: 'no-store' })
        .then(response => {
            if (!response.ok) {
                throw new Error('Falha na requisição.');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var dataMedicao = data.data_formatada;
            document.getElementById('data_medicao').innerHTML = dataMedicao;
        })
        .catch(error => console.error('Falha na captura de rodada', error));
}



    function mostrar() {
        document.getElementById("div_lateral").style.display = "block";
        document.getElementById("btn_tirar").style.display = "block";
        document.getElementById("btn_mostrar").style.display = "none";
    }

    function apagar() {
        document.getElementById("div_lateral").style.display = "none";
        document.getElementById("btn_tirar").style.display = "none";
        document.getElementById("btn_mostrar").style.display = "block";
    }

    function geral() {

        div_silo.innerHTML = `Visão Geral`;
        document.getElementById("sessao_tempsilo1").style.display = "none";
        document.getElementById("sessao_umisilo1").style.display = "none";
        document.getElementById("sessao_tempsilo2").style.display = "none";
        document.getElementById("sessao_umisilo2").style.display = "none";
        document.getElementById("sessao_tempsilo3").style.display = "none";
        document.getElementById("sessao_umisilo3").style.display = "none";
        document.getElementById("sessao_tempsilo4").style.display = "none";
        document.getElementById("sessao_umisilo4").style.display = "none";
        document.getElementById("box_inicio").style.display = "flex";
    }


    function silo1() {
        obterDadosGrafico(idSilo);
        obterDadosGraficotemp(idSilo);

        document.getElementById("box_inicio").style.display = "none";
        document.getElementById("box_silo1").style.display = "flex";
        document.getElementById("sessao_tempsilo1").style.display = "block";
        document.getElementById("sessao_umisilo1").style.display = "block";
        document.getElementById("box_silo2").style.display = "none";
        document.getElementById("sessao_tempsilo2").style.display = "none";
        document.getElementById("sessao_umisilo2").style.display = "none";
        document.getElementById("sessao_tempsilo3").style.display = "none";
        document.getElementById("sessao_umisilo3").style.display = "none";
        document.getElementById("sessao_tempsilo4").style.display = "none";
        document.getElementById("sessao_umisilo4").style.display = "none";

        div_silo.innerHTML = `Silo 1`
        idSilo = 1;

    }




    // umidade silo1
    function obterDadosGrafico(idSilo) {
        fetch(`/medidas/ultimas/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {

            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    // resposta.reverse();

                    plotarGrafico(resposta, idSilo);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');
        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Umidade',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.dtRegistro);
            dados.datasets[0].data.push(registro.umidade);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myCharthumi1`),
            config
        );

        setTimeout(() => atualizarGrafico(idSilo, dados, myChart), 2000);
    }

    function atualizarGrafico(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    // obterdados(idSilo);
                    // alertar(novoRegistro, idAquario);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);

                    //let avisoCaptura = document.getElementById(`avisoCaptura${idSilo}`)
                    //   avisoCaptura.innerHTML = "ver depois"


                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        // avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].dtRegistro)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].dtRegistro); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idSilo, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }

    // temperatura silo1

    function obterDadosGraficotemp(idSilo) {


        // if (proximaAtualizacao != undefined) {
        //     clearTimeout(proximaAtualizacao);
        // }

        fetch(`/medidas/ultimas/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {

            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    // resposta.reverse();

                    plotarGraficotemp(resposta, idSilo);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGraficotemp(resposta, idSilo) {
        setTimeout(() => atualizarGrafico(idSilo, dados, myChart), 2000); 

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'temperatura',
                data: [],
                fill: false,
                borderColor: '#ed9600',
                tension: 0.1
            }]
        } ;

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.dtRegistro);
            dados.datasets[0].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'line',
            data: dados,
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myCharttemp1`),
            config
        );

        setTimeout(() => atualizarGrafico1(idSilo, dados, myChart), 2000);
    }

    function atualizarGrafico1(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    // obterdados(idSilo);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);


                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        // avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].dtRegistro)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        dados.labels.shift();
                        dados.labels.push(novoRegistro[0].dtRegistro);

                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].temperatura);

                        myChart.update();
                    }

                    proximaAtualizacao = setTimeout(() => atualizarGrafico1(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                proximaAtualizacao = setTimeout(() => atualizarGrafico1(idSilo, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }


    // DOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIISSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
    function silo2() {
        idSilo = 2;
        obterDadosGrafico2(idSilo);
        obterDadosGraficotemp2(idSilo);

        document.getElementById("box_inicio").style.display = "none";
        document.getElementById("box_silo1").style.display = "none";
        document.getElementById("sessao_tempsilo1").style.display = "none";
        document.getElementById("sessao_umisilo1").style.display = "none";
        document.getElementById("box_silo2").style.display = "flex";
        document.getElementById("sessao_tempsilo2").style.display = "block";
        document.getElementById("sessao_umisilo2").style.display = "block";
        document.getElementById("sessao_tempsilo3").style.display = "none";
        document.getElementById("sessao_umisilo3").style.display = "none";
        document.getElementById("sessao_tempsilo4").style.display = "none";
        document.getElementById("sessao_umisilo4").style.display = "none";

        div_silo.innerHTML = `Silo 2`;
    }

    function obterDadosGrafico2(idSilo) {
        fetch(`/medidas/ultimas2/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                console.log(response);
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGrafico2(resposta, idSilo);
                });
            } else { console.error('Nenhum dado encontrado ou erro na API AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'); }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGrafico2(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Umidade',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart4`),
            config
        );

        setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);  
    }

    function atualizarGrafico2(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].umidade);

                        myChart.update();
                    } setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }


    // temperatura silo2
    function obterDadosGraficotemp2(idSilo) {
        fetch(`/medidas/ultimas2/temp/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                console.log(response);
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGraficotemp2(resposta, idSilo);
                });
            } else { console.error('Nenhum dado encontrado ou erro na API'); }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGraficotemp2(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Temperatura',
                data: [],
                fill: false,
                borderColor: '#ed9600',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart3`),
            config
        );

        setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);
    }

    function atualizarGraficotemp2(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].temperatura);

                        myChart.update();
                    } setTimeout(() => atualizarGraficotemp2(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGraficotemp2(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }


    // SILO 3 - INICIO  

    function silo3() {
        obterDadosGrafico3(idSilo);
        obterDadosGraficotemp3(idSilo);

        document.getElementById("box_inicio").style.display = "none";
        document.getElementById("box_silo1").style.display = "none";
        document.getElementById("sessao_tempsilo1").style.display = "none";
        document.getElementById("sessao_umisilo1").style.display = "none";
        document.getElementById("box_silo2").style.display = "none";
        document.getElementById("sessao_tempsilo2").style.display = "none";
        document.getElementById("sessao_umisilo2").style.display = "none";
        document.getElementById("box_silo3").style.display = "flex";
        document.getElementById("sessao_tempsilo3").style.display = "block";
        document.getElementById("sessao_umisilo3").style.display = "block";
        document.getElementById("box_silo4").style.display = "none";
        document.getElementById("sessao_tempsilo4").style.display = "none";
        document.getElementById("sessao_umisilo4").style.display = "none";

        div_silo.innerHTML = `Silo 3`;
    }

    
function obterDadosGrafico3(idSilo, idEmpresa) {
    fetch(`/medidas/ultimas3/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                plotarGrafico3(resposta, idSilo);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    }).catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

    function plotarGrafico3(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Umidade',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart8`),
            config
        );

        setTimeout(() => atualizarGrafico3(idSilo, dados, myChart), 2000);
    }

    function atualizarGrafico3(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].umidade);

                        myChart.update();
                    } setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGrafico2(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }


    // temperatura silo 3
    function obterDadosGraficotemp3(idSilo, idEmpresa) {
        fetch(`/medidas/ultimas3/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                console.log(response);
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGraficotemp3(resposta, idSilo);
                });
            } else { console.error('Nenhum dado encontrado ou erro na API'); }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGraficotemp3(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Temperatura',
                data: [],
                fill: false,
                borderColor: '#ed9600',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart7`),
            config
        );

        setTimeout(() => atualizarGrafico3(idSilo, dados, myChart), 2000);
    }

    function atualizarGraficotemp3(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].temperatura);

                        myChart.update();
                    } setTimeout(() => atualizarGraficotemp3(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGraficotemp3(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }


    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function silo4() {
        obterDadosGrafico4(idSilo);
        obterDadosGraficotemp4(idSilo);

        document.getElementById("box_inicio").style.display = "none";
        document.getElementById("box_silo1").style.display = "none";
        document.getElementById("sessao_tempsilo1").style.display = "none";
        document.getElementById("sessao_umisilo1").style.display = "none";
        document.getElementById("box_silo2").style.display = "none";
        document.getElementById("sessao_tempsilo2").style.display = "none";
        document.getElementById("sessao_umisilo2").style.display = "none";
        document.getElementById("box_silo3").style.display = "none";
        document.getElementById("sessao_tempsilo3").style.display = "none";
        document.getElementById("sessao_umisilo3").style.display = "none";
        document.getElementById("box_silo4").style.display = "flex";
        document.getElementById("sessao_tempsilo4").style.display = "block";
        document.getElementById("sessao_umisilo4").style.display = "block";

        div_silo.innerHTML = `Silo 4`;

        idSilo = 4;
    }

    function obterDadosGrafico4(idSilo, idEmpresa) {
    fetch(`/medidas/ultimas4/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                plotarGrafico4(resposta, idSilo);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    }).catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

    function plotarGrafico4(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Umidade',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart10`),
            config
        );

        setTimeout(() => atualizarGrafico4  (idSilo, dados, myChart), 2000);

    }

    function atualizarGrafico4(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].umidade);

                        myChart.update();
                    } setTimeout(() => atualizarGrafico4(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGrafico4(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

// temperatura silo 4
function obterDadosGraficotemp4(idSilo, idEmpresa) {
        fetch(`/medidas/ultimas4/${idSilo}/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                console.log(response);
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGraficotemp4(resposta, idSilo);
                });
            } else { console.error('Nenhum dado encontrado ou erro na API'); }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGraficotemp4(resposta, idSilo) {
        console.log('iniciando plotagem do gráfico...');

        let labels = [];

        let dados = {
            labels: labels,
            datasets: [{
                label: 'Temperatura',
                data: [],
                fill: false,
                borderColor: '#ed9600',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'line',
            data: dados,
        };

        let myChart = new Chart(
            document.getElementById(`myChart9`),
            config
        );

        setTimeout(() => atualizarGraficotemp4(idSilo, dados, myChart), 2000);
    }

    function atualizarGraficotemp4(idSilo, dados, myChart) {
        fetch(`/medidas/tempo-real/${idSilo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                    if (novoRegistro[0].dtRegistro == dados.labels[dados.labels.length - 1]) {
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                    } else {
                        dados.labels.shift();


                        dados.labels.push(novoRegistro[0].momento_grafico);
                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].temperatura);

                        myChart.update();
                    } setTimeout(() => atualizarGraficotemp4(idSilo, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                setTimeout(() => atualizarGraficotemp4(idSilo, dados, myChart), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function maiorTemp() {
        fetch(`/medidas/maiorTemp/${idSilo}`, { cache: 'no-store' })
            .then(response => response.json())
            .then(data => {


                var maiorTemperatura = data.map(item => item.silo_maiortemp);
                console.log(data);
                document.getElementById('maiortemp_milho').innerHTML = maiorTemp;

            })
            .catch(error => console.error('Falha na captura de rodada', error));
    }
    function menorTemp() {
        fetch(`/medidas/menorTemp/${idSilo}`, { cache: 'no-store' })
            .then(response => response.json())
            .then(data => {


                var menorTemperatura = data.map(item => item.silo_menortemp);
                console.log(data);
                document.getElementById('menortemp_milho').innerHTML = menorTemp;

            })
            .catch(error => console.error('Falha na captura de rodada', error));
    }

</script>